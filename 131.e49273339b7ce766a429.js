(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{"2Qtr":function(n,e,t){"use strict";t.r(e);var l=t("CcnG"),o=function(){},i=t("pMnS"),u=t("ra/t"),r=t("ntG5"),s=t("gIcY"),c=t("sn90"),a=t("7r6W"),d=t("TycK"),p=t("wd/R"),h=t("X7Jp"),v=Object.assign||function(n){for(var e,t=1,l=arguments.length;t<l;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},f=function(n,e,t,l){return new(t||(t=Promise))(function(o,i){function u(n){try{s(l.next(n))}catch(n){i(n)}}function r(n){try{s(l.throw(n))}catch(n){i(n)}}function s(n){n.done?o(n.value):new t(function(e){e(n.value)}).then(u,r)}s((l=l.apply(n,e||[])).next())})},g=function(n,e){var t,l,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,l&&(o=2&i[0]?l.return:i[0]?l.throw||((o=l.return)&&o.call(l),0):l.next)&&!(o=o.call(l,i[1])).done)return o;switch(l=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,l=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(n,u)}catch(n){i=[6,n],l=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},m=function(){function n(n,e){var t=this;this.cdr=e,this.groups=[],this.eventClicked=new l.m,this.eventDoubleClicked=new l.m,this.eventDiselected=new l.m,this.eventAdded=new l.m,this.drawStats={windowSize:0,days:0,start:"",end:""},this.vis_timeline=null,this.vis_options={editable:{add:!0,updateTime:!1,updateGroup:!1,remove:!1},stack:!1,stackSubgroups:!1,clickToUse:!1,maxHeight:800,minHeight:200,groupOrder:"content",order:this.eventDisplayOrder,onAdd:function(n,e){console.log("ON ADD:  ",n),delete n.id,t.temp_event=n,e(null)},onUpdate:this.onUpdate,onRemove:this.onUpdate},this.onAdd=function(n,e){console.log("onAdd: ",n);var l=new a.b(v({},n,{type:"box",id:null,_id:null}));t.eventAdded.emit(l),e(null)}}return n.prototype.ngAfterViewInit=function(){var n=this;console.log(this.timeline_ref.nativeElement.textContent),this.vis_timeline=new d.Timeline(this.timeline_ref.nativeElement,[],this.vis_options),this.drawStats.windowSize=this.timeline_ref.nativeElement.offsetHeight,this.setup_timeline(),setTimeout(function(){console.log("1 sec dely"),n.vis_timeline.redraw(),n.vis_timeline.fit(),n.vis_timeline.zoomIn(.1),n.cdr.detectChanges()},1e3),this.redraw()},n.prototype.ngOnDestroy=function(){},n.prototype.ngOnChanges=function(n){console.log("OnChanges: ",n),n.groups&&(console.log("Groups Have Changed"),this.redraw(!0)),n.currentRange&&console.log("%%%%%%%%% Range Changed")},n.prototype.redraw=function(n){return void 0===n&&(n=!1),f(this,void 0,void 0,function(){var e,t,l;return g(this,function(o){switch(o.label){case 0:return console.log("REDRAWING....",this.groups),[4,this.getVisibleGroups(this.groups)];case 1:e=o.sent(),t=[],l=0,o.label=2;case 2:return l<e.length?[4,t.concat(this.getVisibleGroupEvents(e[l]))]:[3,5];case 3:t=o.sent(),console.log("visibleGroups->foreach: ",t),o.label=4;case 4:return l++,[3,2];case 5:return console.log("Adding to Timeline: ",e,t),this.vis_timeline.setGroups(e),this.vis_timeline.setItems(t),n&&this.vis_timeline.fit(),this.cdr.detectChanges(),[2]}})})},n.prototype.getVisibleGroups=function(n){return f(this,void 0,void 0,function(){var e,t;return g(this,function(l){return e=[],t=this.groups.map(function(t){return t.id=t._id,t._nestedGroups&&0!==t._nestedGroups.length?t.showNested?t.nestedGroups=t._nestedGroups.filter(function(e){return void 0!==n.find(function(n){return n._id===e})}):(t.nestedGroups=[],e=e.concat(t._nestedGroups),console.log("Subgroups concat: ",e)):delete t.nestedGroups,t}).filter(function(n){return void 0===e.find(function(e){return e===n.id})}),console.log("Visible Groups:  ",t),[2,t]})})},n.prototype.getVisibleGroupEvents=function(n){var e=this;console.log("GetVisibleGroupEvents: ",n);var t=[],l={},o=a.d.findIndex(function(n){return n.days<e.drawStats.days});o=-1!==o?o:a.d.length,console.log("Spanlevel index: ",o);for(var i=0;i<n.events.length;i++){var u=this.getProcessedEvent(n.events[i],o);u.id.startsWith("LABEL")?(console.log("Found Label",u),l[u.content]?(p(u.start)<p(l[u.content].start)&&(l[u.content].start=u.start),l[u.content].end?u.end&&p(u.end)>p(l[u.content].end)&&(l[u.content].end=u.end):l[u.content].end=u.end,l[u.content].title=l[u.content].title+"<BR>"+u.title,l[u.content].counter++):(u.group=n.id,l[u.content]=u)):t.push(u)}return Object.entries(l).forEach(function(n){var e=n[1];e.content=e.content+"("+e.counter+")",t.push(e)}),console.log("Returning visible events:",t),t},n.prototype.getProcessedEvent=function(n,e){for(var t=e;t<a.d.length;t++){var l=n[a.d[t].type+"Label"];if(l)return{title:n.content,content:l,start:n.start,end:n.end,id:"LABEL"+n.id,group:n.group,counter:1}}return n},n.prototype.onUpdate=function(n,e){console.log("OnUpdate: ",n),e(n)},n.prototype.onRemove=function(n,e){console.log("Removing Item: ",n),e(n)},n.prototype.onResize=function(n){console.log("Window resize: ",n.target.innerWidth,n),this.drawStats.windowSize=n.target.innerWidth},n.prototype.eventDisplayOrder=function(n,e){return n.content-e.content},n.prototype.setup_timeline=function(){var n=this;this.vis_timeline.on("rangechange",function(n){}),this.vis_timeline.on("rangechanged",function(e){console.log("rangechanged",e);var t=p(e.start),l=p(e.end),o=p.duration(l.diff(t));n.drawStats.start=t.format("YYYY-MM-DD"),n.drawStats.end=l.format("YYYY-MM-DD"),n.drawStats.windowSize=n.timeline_ref.nativeElement.offsetWidth,n.drawStats.days=o.asDays();var i=a.d.find(function(e){return n.drawStats.days>e.days});n.currentRange!==i.type&&(n.currentRange=i.type,console.log("%%%%%% RANGE CHANGED",n.currentRange),n.redraw()),n.cdr.detectChanges(),console.log("Timeline resize data: ",n.drawStats)}),this.vis_timeline.on("select",function(n){}),this.vis_timeline.on("itemover",function(n){}),this.vis_timeline.on("itemout",function(n){}),this.vis_timeline.on("click",function(e){console.log("click!!!!!",e),e.item&&n.eventClicked.emit(e.item)}),this.vis_timeline.on("doubleClick",function(e){return f(n,void 0,void 0,function(){var n;return g(this,function(t){return console.log("doubleClick",e),e.item?this.eventDoubleClicked.emit(e.item):(n=new a.b(v({start:e.time,content:"new",type:"box",id:null,_id:null})),this.eventAdded.emit(n)),[2]})})}),this.vis_timeline.on("contextmenu",function(n){}),this.vis_timeline.on("mouseDown",function(n){}),this.vis_timeline.on("mouseUp",function(e){if(console.log("mouseUp",e),"group-label"===e.what){console.log("group-label");var t=n.groups.find(function(n){return n._id===e.group});console.log(t),t.nestedGroups&&(t.showNested=!1===t.showNested,console.log("New Group: ",t),n.redraw())}}),document.getElementById("zoomIn").onclick=function(){n.vis_timeline.zoomIn(.2)},document.getElementById("zoomOut").onclick=function(){n.vis_timeline.zoomOut(.2)},document.getElementById("moveLeft").onclick=function(){n.timeline_move(.2)},document.getElementById("moveRight").onclick=function(){n.timeline_move(-.2)},document.getElementById("fitContents").onclick=function(){n.vis_timeline.fit()},this.redraw()},n.prototype.onSelectTimelineEvent=function(n){0===n.items.length?this.eventDiselected.emit():this.eventClicked.emit(n.items[0])},n.prototype.timeline_move=function(n){var e=this.vis_timeline.getWindow(),t=e.end-e.start;this.vis_timeline.setWindow({start:e.start.valueOf()-t*n,end:e.end.valueOf()-t*n})},n.prototype.printStats=function(){var n=this.drawStats.days.toFixed(2),e=(this.drawStats.days/365e3).toFixed(1);return n+" days, ("+this.currentRange+") "+e+" milleniums"},n}(),b=l.La({encapsulation:0,styles:[["#timeline[_ngcontent-%COMP%]{box-sizing:border-box;width:100%}"]],data:{}});function y(n){return l.db(2,[l.ab(402653184,1,{timeline_ref:0}),(n()(),l.Na(1,0,[[1,0],["timeline",1]],null,7,"div",[],null,[["window","resize"]],function(n,e,t){var l=!0;return"window:resize"===e&&(l=!1!==n.component.onResize(t)&&l),l},null,null)),(n()(),l.Na(2,0,null,null,6,"div",[["class","menu"]],null,null,null,null,null)),(n()(),l.Na(3,0,null,null,0,"input",[["id","zoomIn"],["type","button"],["value","Zoom in"]],null,null,null,null,null)),(n()(),l.Na(4,0,null,null,0,"input",[["id","zoomOut"],["type","button"],["value","Zoom out"]],null,null,null,null,null)),(n()(),l.Na(5,0,null,null,0,"input",[["id","moveLeft"],["type","button"],["value","Left"]],null,null,null,null,null)),(n()(),l.Na(6,0,null,null,0,"input",[["id","moveRight"],["type","button"],["value","Right"]],null,null,null,null,null)),(n()(),l.Na(7,0,null,null,0,"input",[["id","fitContents"],["type","button"],["value","Fit"]],null,null,null,null,null)),(n()(),l.cb(8,null,[" "," "]))],null,function(n,e){n(e,8,0,e.component.printStats())})}var w=t("M9A9"),k=t("ZYCi"),_=t("Ip0R"),C=(t("OO+k"),t("eF7p")),E=t("HC5s"),D=Object.assign||function(n){for(var e,t=1,l=arguments.length;t<l;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},S=function(n,e,t,l){return new(t||(t=Promise))(function(o,i){function u(n){try{s(l.next(n))}catch(n){i(n)}}function r(n){try{s(l.throw(n))}catch(n){i(n)}}function s(n){n.done?o(n.value):new t(function(e){e(n.value)}).then(u,r)}s((l=l.apply(n,e||[])).next())})},M=function(n,e){var t,l,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function r(i){return function(r){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,l&&(o=2&i[0]?l.return:i[0]?l.throw||((o=l.return)&&o.call(l),0):l.next)&&!(o=o.call(l,i[1])).done)return o;switch(l=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,l=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(n,u)}catch(n){i=[6,n],l=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,r])}}},G=function(){function n(n,e,t){this.docService=n,this.modalController=e,this.cdr=t,this.groups=[],this.visible_groups=[]}return n.prototype.ngOnInit=function(){console.log("ListPage -> ngOnInit"),this.setup_subscriptions()},n.prototype.onGroupChange=function(n){return S(this,void 0,void 0,function(){var e,t;return M(this,function(l){switch(l.label){case 0:return console.log("Group Changed: ",n,this.groups),(e=D({},n)).visible=!e.visible,e.showNested=!0,e.visible?(t=e,[4,this.docService.getByQuery("group","=",n.id,h.c)]):[3,2];case 1:return t.events=l.sent(),[3,3];case 2:e.events=[],l.label=3;case 3:return this.groups=Object(E.a)(e,this.groups,"id"),this.redraw(),[2]}})})},n.prototype.setup_subscriptions=function(){return S(this,void 0,void 0,function(){var n,e=this;return M(this,function(t){switch(t.label){case 0:return this.eventSubscription=this.docService.subscribeChanges(h.c).subscribe(function(n){return S(e,void 0,void 0,function(){var e;return M(this,function(t){return console.log("Event Subscription: ",n),(e=this.visible_groups.find(function(e){return e.id===n[0].group}))&&(console.log("FORCE TIMELINE REDRAW"),e.events=Object(E.a)(n[0],e.events,"id"),this.visible_groups=this.visible_groups.concat([]),this.cdr.detectChanges()),[2]})})}),this.groupSubscription=this.docService.subscribeChanges(h.d).subscribe(function(n){return S(e,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return[4,this.docService.getAllDocs(h.d)];case 1:return n=e.sent(),console.log("Groups:::: ",n),this.groups=n.sort(function(n,e){return n.content<e.content?-1:n.content>e.content?1:0}),console.log("Group-Subscription: ",this.groups),this.redraw(),[2]}})})}),n=this,[4,this.docService.getAllDocs(h.d)];case 1:return n.groups=t.sent(),console.log("List Loaded Groups: ",this.groups),this.redraw(),[2]}})})},n.prototype.redraw=function(){this.visible_groups=this.groups.filter(function(n){return n.visible}),this.cdr.detectChanges()},n.prototype.onEventClicked=function(n){console.log("onEventClicked",n)},n.prototype.onEventDoubleClicked=function(n){return S(this,void 0,void 0,function(){var e;return M(this,function(t){switch(t.label){case 0:return console.log("onEventDoubleClicked",n),[4,this.docService.getDocById(n,h.c)];case 1:return e=t.sent(),console.log("Dobleclicke item: ",e),e&&this.showEditEventModal(e),[2]}})})},n.prototype.onEventDiselected=function(){console.log("onEventDiselected")},n.prototype.onEventAdded=function(n){console.log("onEventAdded",n),this.showEditEventModal(n)},n.prototype.showEditEventModal=function(n){return S(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return[4,this.modalController.create({component:C.a,componentProps:{item:n,groups:this.groups}})];case 1:return e.sent().present(),[2]}})})},n.prototype.printGroupById=function(n){var e=this.groups.find(function(e){return e.id===n});return e?" -- "+e.content:""},n.prototype.printStartDate=function(n){return n.start?p(n.start).format("YYYY-MM-DD"):""},n.prototype.printEndDate=function(n){return n.end?" -- "+p(n.end).format("YYYY-MM-DD"):""},n}(),N=t("9opb"),O=l.La({encapsulation:0,styles:[[""]],data:{}});function x(n){return l.db(0,[(n()(),l.Na(0,0,null,null,8,"ion-chip",[],null,null,null,u.O,u.i)),l.Ma(1,49152,null,0,r.n,[l.k],null,null),(n()(),l.Na(2,0,null,0,2,"ion-label",[],null,null,null,u.W,u.q)),l.Ma(3,49152,null,0,r.L,[l.k],null,null),(n()(),l.cb(4,0,["",""])),(n()(),l.Na(5,0,null,0,3,"ion-toggle",[["color","secondary"]],null,[[null,"ionChange"],[null,"ionBlur"]],function(n,e,t){var o=!0,i=n.component;return"ionChange"===e&&(o=!1!==l.Xa(n,8)._handleIonChange(t.target.checked)&&o),"ionBlur"===e&&(o=!1!==l.Xa(n,8)._handleBlurEvent()&&o),"ionChange"===e&&(o=!1!==i.onGroupChange(n.context.$implicit)&&o),o},u.Ja,u.D)),l.Za(5120,null,s.e,function(n){return[n]},[c.a]),l.Ma(7,49152,null,0,r.Wa,[l.k],{color:[0,"color"],checked:[1,"checked"]},null),l.Ma(8,16384,null,0,c.a,[l.k],null,null)],function(n,e){n(e,7,0,"secondary",e.context.$implicit.visible)},function(n,e){n(e,4,0,e.context.$implicit.content)})}function A(n){return l.db(2,[(n()(),l.Na(0,0,null,null,10,"ion-header",[],null,null,null,u.S,u.m)),l.Ma(1,49152,null,0,r.y,[l.k],null,null),(n()(),l.Na(2,0,null,0,8,"ion-toolbar",[],null,null,null,u.La,u.E)),l.Ma(3,49152,null,0,r.Xa,[l.k],null,null),(n()(),l.Na(4,0,null,0,3,"ion-buttons",[["slot","start"]],null,null,null,u.I,u.c)),l.Ma(5,49152,null,0,r.g,[],null,null),(n()(),l.Na(6,0,null,0,1,"ion-menu-button",[],null,null,null,u.Y,u.t)),l.Ma(7,49152,null,0,r.P,[l.k],null,null),(n()(),l.Na(8,0,null,0,2,"ion-title",[],null,null,null,u.Ka,u.F)),l.Ma(9,49152,null,0,r.Ya,[l.k],null,null),(n()(),l.cb(-1,0,[" Timeline "])),(n()(),l.Na(11,0,null,null,17,"ion-content",[],null,null,null,u.Q,u.k)),l.Ma(12,49152,null,0,r.r,[l.k],null,null),(n()(),l.Na(13,0,null,0,1,"app-timeline",[],null,[[null,"eventClicked"],[null,"eventDoubleClicked"],[null,"eventDiselected"],[null,"eventAdded"]],function(n,e,t){var l=!0,o=n.component;return"eventClicked"===e&&(l=!1!==o.onEventClicked(t)&&l),"eventDoubleClicked"===e&&(l=!1!==o.onEventDoubleClicked(t)&&l),"eventDiselected"===e&&(l=!1!==o.onEventDiselected()&&l),"eventAdded"===e&&(l=!1!==o.onEventAdded(t)&&l),l},y,b)),l.Ma(14,4898816,null,0,m,[h.b,l.h],{groups:[0,"groups"]},{eventClicked:"eventClicked",eventDoubleClicked:"eventDoubleClicked",eventDiselected:"eventDiselected",eventAdded:"eventAdded"}),(n()(),l.Na(15,0,null,0,13,"ion-item",[],null,[[null,"click"]],function(n,e,t){var o=!0;return"click"===e&&(o=!1!==l.Xa(n,17).onClick(t)&&o),o},u.V,u.p)),l.Ma(16,49152,null,0,r.F,[l.k],null,null),l.Ma(17,16384,null,0,w.a,[[2,k.l],l.k],null,null),(n()(),l.Na(18,0,null,0,10,"ion-card",[],null,null,null,u.M,u.d)),l.Ma(19,49152,null,0,r.h,[l.k],null,null),(n()(),l.Na(20,0,null,0,4,"ion-card-header",[],null,null,null,u.K,u.f)),l.Ma(21,49152,null,0,r.j,[l.k],null,null),(n()(),l.Na(22,0,null,0,2,"ion-card-subtitle",[],null,null,null,u.L,u.g)),l.Ma(23,49152,null,0,r.k,[l.k],null,null),(n()(),l.cb(-1,0,["Select which groups are visible"])),(n()(),l.Na(25,0,null,0,3,"ion-card-content",[],null,null,null,u.J,u.e)),l.Ma(26,49152,null,0,r.i,[l.k],null,null),(n()(),l.Ea(16777216,null,0,1,null,x)),l.Ma(28,278528,null,0,_.h,[l.M,l.J,l.q],{ngForOf:[0,"ngForOf"]},null)],function(n,e){var t=e.component;n(e,14,0,t.visible_groups),n(e,28,0,t.groups)},null)}var I=l.Ja("app-list",G,function(n){return l.db(0,[(n()(),l.Na(0,0,null,null,1,"app-list",[],null,null,null,A,O)),l.Ma(1,114688,null,0,G,[h.b,N.a,l.h],null,null)],function(n,e){n(e,1,0)},null)},{},{},[]),R=t("95zI"),V=t("apKv"),Y=t("B4/3"),z=t("j1ZV");t.d(e,"ListPageModuleNgFactory",function(){return L});var L=l.Ka(o,[],function(n){return l.Ua([l.Va(512,l.j,l.Z,[[8,[i.a,I]],[3,l.j],l.v]),l.Va(4608,_.k,_.j,[l.s,[2,_.r]]),l.Va(4608,s.n,s.n,[]),l.Va(4608,R.a,R.a,[l.x,l.g]),l.Va(4608,N.a,N.a,[R.a,l.j,l.p]),l.Va(4608,V.a,V.a,[R.a,l.j,l.p]),l.Va(1073742336,_.b,_.b,[]),l.Va(1073742336,s.l,s.l,[]),l.Va(1073742336,s.c,s.c,[]),l.Va(1073742336,Y.a,Y.a,[]),l.Va(1073742336,z.a,z.a,[]),l.Va(1073742336,k.n,k.n,[[2,k.t],[2,k.l]]),l.Va(1073742336,o,o,[]),l.Va(1024,k.j,function(){return[[{path:"",component:G}]]},[])])})}}]);